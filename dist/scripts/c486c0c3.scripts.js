"use strict";angular.module("londonBusStopsApp",["ui.map","ui.event","ui.bootstrap","ui.bootstrap.modal","ui.bootstrap.tpls","angularSpinner"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MapsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("londonBusStopsApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("londonBusStopsApp").controller("MapsCtrl",["$scope",function(a){function b(){console.warn("no location")}function c(){var b,c=a.myMap.getBounds(),d=c.getNorthEast(),e=c.getSouthWest(),f="http://digitaslbi-id-test.herokuapp.com/bus-stops?northEast="+d.lb+","+d.mb+"&southWest="+e.lb+","+e.mb;jQuery.ajax({dataType:"jsonp",url:f,success:function(c){console.warn(c),a.loading=!1,jQuery.each(c.markers,function(c,d){b=new google.maps.LatLng(d.lat,d.lng);var e=new google.maps.Marker({map:a.myMap,position:b,icon:"images/london-buses-logo.png"});e.stopInfo=d,a.busStops.push(e)}),a.showNextArrivals=function(b){a.open(b)}},error:function(a,b,c){console.warn("fail",b,c)}})}a.loading=!0,a.busStops=[];var d;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){d=new google.maps.LatLng(b.coords.latitude,b.coords.longitude),a.myMap.setCenter(d),c(),google.maps.event.addListener(a.myMap,"zoom_changed",function(){c()}),google.maps.event.addListener(a.myMap,"center_changed",function(){c()})},function(){b()}):b(),a.mapOptions={center:new google.maps.LatLng(35.784,-78.67),zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP}}]),angular.module("londonBusStopsApp").controller("ModalCtrl",["$scope","$modal","$log",function(a,b,c){a.items=[],a.open=function(d){a.loading=!0;var e="http://digitaslbi-id-test.herokuapp.com/bus-stops/"+d.stopInfo.id;a.stopInfo=d.stopInfo,jQuery.ajax({dataType:"jsonp",url:e,success:function(e){a.loading=!1;var f=b.open({templateUrl:"nextArrivals.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return e.infos=d.stopInfo,a.items=e.arrivals,e}}});f.result.then(function(b){a.items=b},function(){c.info("Modal dismissed at: "+new Date)})},error:function(){return!1}})}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","items",function(a,b,c){a.items=c,a.selected={item:a.items[0]},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]);